(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"11":function(e,t,a){e.exports=a(0)(18)},"12":function(e,t,a){"use strict";e.exports.locality_address="https://xyx-mainland-api.raink.com.cn"},"18":function(e,t,a){},"8":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.default=void 0;var n=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),l=a(1),i=_interopRequireDefault(l),o=_interopRequireDefault(a(2)),s=a(11),d=a(13);a(18);var c=_interopRequireDefault(a(12));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var u=function(e){function Maintask(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Maintask);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Maintask.__proto__||Object.getPrototypeOf(Maintask)).apply(this,arguments));return e.config={"navigationBarTitleText":"主线任务"},e.state={"maintask":[],"showaddmodel":!1,"addtitle":"","addcontext":"","addtime":"","showSheetstate":!1,"cardid":"","locktaskstate":!1,"currenttime":{"length_time":"","complete_time":""},"currenttask":{"id":"2","username":"朱海涛","openid":"o-GjW5XADtUav0uDKr319xbTe9mk","title":"任务1","content":"内容1","date":"2018-12","length_time":"100","create_time":"2018-12-20 09:54:40","complete_time":"100"},"complete_time_temp":0,"deltitle":"","showupdatetime":!1,"showdelTask":!1,"showUpdatetask":!1,"islogin":!1,"complete_time":""},e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Maintask,l.Component),n(Maintask,[{"key":"componentWillMount","value":function componentWillMount(){}},{"key":"componentDidMount","value":function componentDidMount(){}},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){var e=this;""!==i.default.getStorageSync("phone")?(this.setState({"islogin":!1}),i.default.request({"url":c.default.locality_address+"/v1/work/task","data":{"phone":i.default.getStorageSync("phone"),"scene":"web"}}).then(function(t){200==t.data.code&&e.setState({"maintask":t.data.result})}),this.setState({"locktaskstate":i.default.getStorageSync("locktaskstate")}),this.setState({"showSheetstate":!1,"cardid":""})):this.setState({"islogin":!0})}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"emptyfunction","value":function emptyfunction(){}},{"key":"render","value":function render(){var e=this,t=this.state.maintask.map(function(t){return o.default.createElement(s.View,{"className":"card","id":t.id,"onClick":e.showSheet.bind(e)},o.default.createElement(d.AtCard,{"extra":t.create_time,"title":t.title},t.content,o.default.createElement(d.AtProgress,{"percent":parseInt(t.complete_time),"status":100==parseInt(t.complete_time)?"success":"progress"})))});return o.default.createElement(s.View,{"className":"index"},o.default.createElement(s.View,null,o.default.createElement(s.View,{"className":"backplus"},o.default.createElement(s.Image,{"src":"https://cdn-xyx.raink.com.cn/elsfkxxk/201901051546668599.png","style":"height: 57px;width: 145px;margin: 5px  0 0 25px;"}),o.default.createElement(d.AtButton,{"size":"small","circle":!0,"type":"secondary","className":"back","onClick":this.back.bind(this)},"返回"))),o.default.createElement(s.View,{"className":"tasktitle"},o.default.createElement(d.AtButton,{"size":"small","type":"primary","className":"addtask","onClick":this.showaddmodel.bind(this)},"添加任务"),o.default.createElement(s.View,{"className":"titleelement"},o.default.createElement(d.AtSwitch,{"border":!1,"onChange":this.changelockstate.bind(this),"customStyle":"padding:0 0 0 0;","checked":this.state.locktaskstate,"title":"锁定"}))),o.default.createElement(s.View,{"className":"scrollview","style":"width:100%"},t),o.default.createElement(d.AtModal,{"isOpened":this.state.islogin,"closeOnClickOverlay":!1},o.default.createElement(d.AtModalHeader,null,"提示"),o.default.createElement(d.AtModalContent,null,o.default.createElement(s.View,{"className":"delmode"},o.default.createElement(s.Text,null,"您还没有登录,点击确定前往首页登录"))),o.default.createElement(d.AtModalAction,null,o.default.createElement(s.Button,{"style":"color:#6190E8","onClick":this.gotoindex.bind(this,1,"点击了确定")},"确定"))),o.default.createElement(d.AtModal,{"isOpened":this.state.showaddmodel,"closeOnClickOverlay":!1,"onClose":this.closeModal.bind(this,1,"Modal被关闭了")},o.default.createElement(d.AtModalHeader,null,"添加任务"),o.default.createElement(d.AtModalContent,null,o.default.createElement(s.View,{"className":"addmodel"},o.default.createElement(d.AtInput,{"name":"value1","title":"标题","type":"text","placeholder":"任务标题","value":this.state.addtitle,"onChange":this.titleChange.bind(this),"customStyle":"border:1px solid  #d6e4ef;padding:15rpx 0;border-radius:8rpx;"}),o.default.createElement(s.View,{"style":"width:100%"},this.state.showaddmodel&&o.default.createElement(d.AtTextarea,{"value":this.state.addcontext,"onChange":this.contextChange.bind(this),"maxlength":"400","placeholder":"计划内容","className":"addcontextarea"})))),o.default.createElement(d.AtModalAction,null,o.default.createElement(s.Button,{"onClick":this.closeModal.bind(this,1,"点击了取消")},"取消"),o.default.createElement(s.Button,{"style":"color:#6190E8","onClick":this.addtask.bind(this,1,"点击了确定")},"确定"))),o.default.createElement(d.AtActionSheet,{"isOpened":this.state.showSheetstate,"onClose":this.closesheet1.bind(this),"onCancel":this.closesheet.bind(this),"cancelText":"取消","title":"操作"},o.default.createElement(d.AtActionSheetItem,{"onClick":this.updatetime.bind(this)},"更新进度"),o.default.createElement(d.AtActionSheetItem,{"onClick":this.toincident.bind(this)},"任务详情"),o.default.createElement(d.AtActionSheetItem,{"onClick":this.deltask.bind(this)},"删除")),o.default.createElement(d.AtModal,{"isOpened":this.state.showupdatetime,"onClose":this.closeUpdateTime.bind(this,1,"Modal被关闭了")},o.default.createElement(d.AtModalHeader,null,"更新进度"),o.default.createElement(d.AtModalContent,null,o.default.createElement(s.View,{"className":"rangeview"},o.default.createElement(s.Input,{"name":"value1","type":"range","value":this.state.complete_time,"onChange":this.changeComplete_time.bind(this),"max":100,"min":this.state.complete_time_temp,"step":5,"id":"range1","className":"weui-input"}),o.default.createElement(s.Text,null,this.state.complete_time))),o.default.createElement(d.AtModalAction,null,o.default.createElement(s.Button,{"onClick":this.closeUpdateTime.bind(this,1,"点击了取消")},"取消"),o.default.createElement(s.Button,{"style":"color:#6190E8","onClick":this.UpdateTime.bind(this,1,"点击了确定")},"确定"))),o.default.createElement(d.AtModal,{"isOpened":this.state.showdelTask,"onClose":this.closedeltask.bind(this,1,"Modal被关闭了")},o.default.createElement(d.AtModalHeader,null,"删除任务"),o.default.createElement(d.AtModalContent,null,o.default.createElement(s.View,{"className":"delmode"},o.default.createElement(s.Text,null,"确定删除",this.state.deltitle,"?"))),o.default.createElement(d.AtModalAction,null,o.default.createElement(s.Button,{"onClick":this.closedeltask.bind(this,1,"点击了取消")},"取消"),o.default.createElement(s.Button,{"style":"color:#6190E8","onClick":this.Deltask.bind(this,1,"点击了确定")},"确定"))))}},{"key":"back","value":function back(){i.default.navigateBack()}},{"key":"gotoindex","value":function gotoindex(){i.default.navigateTo({"url":"/pages/index/index"})}},{"key":"changelockstate","value":function changelockstate(){this.setState({"locktaskstate":!this.state.locktaskstate}),i.default.setStorageSync("locktaskstate",!this.state.locktaskstate)}},{"key":"showaddmodel","value":function showaddmodel(){this.setState({"showaddmodel":!0})}},{"key":"closeModal","value":function closeModal(){this.setState({"showaddmodel":!1,"addtitle":"","addcontext":"","addtime":""})}},{"key":"addtask","value":function addtask(e){var t=this;i.default.showLoading({"title":"正在添加"}),""!=this.state.addtitle&&""!=this.state.addcontext?i.default.request({"url":c.default.locality_address+"/v1/work/addmain","data":{"phone":i.default.getStorageSync("phone"),"scene":"web","title":this.state.addtitle,"content":this.state.addcontext},"method":"POST","header":{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){200==e.data.code?t.setState({"maintask":e.data.result}):10007==e.data.code&&i.default.showToast({"title":"当月只能添加五个任务","icon":"none"}),t.closeModal(),i.default.hideLoading()}).catch(function(){i.default.showToast({"title":"网络错误!","icon":"none"})}):i.default.showToast({"title":"信息不能为空","icon":"none"})}},{"key":"showSheet","value":function showSheet(e){console.log(2123123123123),this.state.locktaskstate||(console.log(e),this.setState({"showSheetstate":!0,"cardid":e.currentTarget.id}))}},{"key":"closesheet","value":function closesheet(e){this.setState({"showSheetstate":!1,"cardid":""})}},{"key":"closesheet1","value":function closesheet1(e){this.setState({"showSheetstate":!1})}},{"key":"titleChange","value":function titleChange(e){console.log(e),this.setState({"addtitle":e})}},{"key":"contextChange","value":function contextChange(e){console.log(e.detail.value),this.setState({"addcontext":e.nativeEvent.target.value})}},{"key":"timeChange","value":function timeChange(e){console.log(e),this.setState({"addtime":e})}},{"key":"updatetime","value":function updatetime(e){for(var t={"length_time":"","complete_time":""},a="",n=0;n<this.state.maintask.length;n++)console.log(this.state.maintask[n]),console.log(this.state.maintask[n].id),this.state.maintask[n].id==this.state.cardid&&(t.length_time=this.state.maintask[n].length_time,t.complete_time=this.state.maintask[n].complete_time,a=this.state.maintask[n].complete_time);this.setState({"currenttime":t,"showupdatetime":!0,"showSheetstate":!1,"complete_time":a,"complete_time_temp":a})}},{"key":"changeComplete_time","value":function changeComplete_time(e){console.log(e),this.setState({"complete_time":e.detail.value})}},{"key":"closeUpdateTime","value":function closeUpdateTime(){this.setState({"currenttime":{"length_time":"","complete_time":""},"showupdatetime":!1,"complete_time_temp":"","cardid":"","complete_time":""})}},{"key":"UpdateTime","value":function UpdateTime(){var e=this;i.default.showLoading({"title":"请稍候..."}),i.default.request({"url":c.default.locality_address+"/v1/work/updatetask","data":{"phone":i.default.getStorageSync("phone"),"scene":"web","taskid":this.state.cardid,"complete_time":this.state.complete_time},"method":"POST","header":{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){200==t.data.code?e.setState({"currenttime":{"length_time":"","complete_time":""},"showupdatetime":!1,"complete_time_temp":"","cardid":"","maintask":t.data.result,"complete_time":""}):i.default.showToast({"title":"错误!","icon":"none"}),i.default.hideLoading()}).catch(function(e){i.default.hideLoading(),i.default.showToast({"title":"网络错误!","icon":"none"})})}},{"key":"updatetask","value":function updatetask(e){}},{"key":"deltask","value":function deltask(e){for(var t=0;t<this.state.maintask.length;t++)this.state.maintask[t].id==this.state.cardid&&this.setState({"deltitle":this.state.maintask[t].title});this.setState({"showdelTask":!0,"showSheetstate":!1})}},{"key":"closedeltask","value":function closedeltask(){this.setState({"deltitle":"","showdelTask":!1,"cardid":""})}},{"key":"Deltask","value":function Deltask(){var e=this;i.default.showLoading({"title":"请稍候..."}),i.default.request({"url":c.default.locality_address+"/v1/work/deltask","data":{"phone":i.default.getStorageSync("phone"),"scene":"web","taskid":this.state.cardid},"method":"POST","header":{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){200==t.data.code?e.setState({"showdelTask":!1,"cardid":"","deltitle":"","maintask":t.data.result}):i.default.showToast({"title":"错误!","icon":"none"}),i.default.hideLoading()}).catch(function(e){i.default.hideLoading(),i.default.showToast({"title":"网络错误!","icon":"none"})})}},{"key":"toincident","value":function toincident(){i.default.navigateTo({"url":"/pages/incident/incident?taskid="+this.state.cardid})}}]),Maintask}();t.default=u}}]);